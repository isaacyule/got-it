<div class="container-messages">
  <div class="messages">
    <div id="real-messages-container">
      <% @messages.each do |message| %>
        <%= render 'message', message: message, user_is_author: message.user == current_user %>
      <% end %>
    </div>
    <%= form_for [@conversation, @message], html: {class: "ui reply form"}, remote: true do |f| %>
     <div class="flex">
       <%= f.text_area :body, class: "form-control chat-input" %>
     <%= f.text_field :user_id, value: current_user.id, type: "hidden" %>
       <%= f.submit "Add Reply", class: "chat-btn ui blue labeled submit icon button" %>
     </div>
    <% end %>
  </div>
  <div class="request-summary">
    <%= render "request_summary_messages_lender" %>
  </div>
</div>



<% content_for :after_js do %>
  <script>
    scrollLastMessageIntoView();
    App['conversation_<%= @conversation.id %>'] = App.cable.subscriptions.create(
      {
        channel: 'ConversationChannel',
        conversation_id: <%= @conversation.id %> },
      {
        received: (data) => {
          if (data.current_user_id !== <%= current_user.id %>) {
            const messagesContainer = document.querySelector('#real-messages-container');
            messagesContainer.insertAdjacentHTML('beforeend', data.message_partial);
            scrollLastMessageIntoView();
          }
        }
      }
    )
  </script>
<% end %>
